# Step 3.1: Update Backend Environment Configuration

**Objective:** Add Docker-specific DATABASE_URL to backend .env.example template

## Files to Modify

- `src/backend/.env.example`

## Implementation

### Step-by-Step Instructions

#### Step 1: Update src/backend/.env.example

Add/update the DATABASE_URL configuration with clear comments:

```bash
# ============================================
# Server Configuration
# ============================================
NODE_ENV=development
PORT=3001
HOST=localhost

# ============================================
# Database Configuration
# ============================================

# Local Development (Docker Compose)
# Use this connection string when running PostgreSQL via Docker
DATABASE_URL=postgresql://dovvydive:dev_password@localhost:5432/dovvydive

# Production (Neon PostgreSQL)
# Replace with your Neon connection string in production
# Example format:
# DATABASE_URL=postgresql://user:password@ep-cool-name-123456.us-east-2.aws.neon.tech/dovvydive?sslmode=require

# Connection Pool Settings (Prisma)
# Adjust based on environment and load
# DATABASE_POOL_SIZE=10
# DATABASE_POOL_TIMEOUT=30000

# ============================================
# Google AI Services
# ============================================
GOOGLE_API_KEY=your_google_api_key_here
GOOGLE_MAPS_KEY=your_google_maps_api_key_here

# ============================================
# External APIs
# ============================================
WEATHER_API_KEY=your_weather_api_key_here

# ============================================
# Security
# ============================================
# JWT secret for session signing (minimum 32 characters)
JWT_SECRET=your_jwt_secret_for_session_signing_min_32_chars

# CORS origin (frontend URL)
CORS_ORIGIN=http://localhost:3000

# ============================================
# Rate Limiting
# ============================================
RATE_LIMIT_WINDOW_MS=3600000
RATE_LIMIT_MAX_REQUESTS=100

# ============================================
# Logging
# ============================================
LOG_LEVEL=info
```

**Key Changes:**

1. **DATABASE_URL**: Clear example for Docker local development
2. **Comments**: Distinguish between local (Docker) and production (Neon) connection strings
3. **Format**: Show SSL requirement for production connections
4. **Optional**: Pool settings commented out (defaults are fine for MVP)

#### Step 2: Verify Format

Ensure the connection string format is correct:

**Local (Docker):**
```
postgresql://[user]:[password]@[host]:[port]/[database]
postgresql://dovvydive:dev_password@localhost:5432/dovvydive
```

**Production (Neon):**
```
postgresql://[user]:[password]@[host]/[database]?sslmode=require
postgresql://user:pass@ep-name.region.aws.neon.tech/dovvydive?sslmode=require
```

## Verification Steps

### 1. Verify File Updated

```bash
cat src/backend/.env.example | grep DATABASE_URL
```

Expected output:
```
# Use this connection string when running PostgreSQL via Docker
DATABASE_URL=postgresql://dovvydive:dev_password@localhost:5432/dovvydive
# DATABASE_URL=postgresql://user:password@ep-cool-name-123456.us-east-2.aws.neon.tech/dovvydive?sslmode=require
```

### 2. Create Local .env File

Copy the example to create actual environment file:

```bash
cp src/backend/.env.example src/backend/.env
```

### 3. Verify .env is Gitignored

```bash
# .env should be listed in .gitignore
cat .gitignore | grep "\.env"
```

Expected to see:
```
.env
.env.local
.env.*.local
```

### 4. Test Connection String Format (Optional)

Once backend is scaffolded (PR 1.4), test connection:

```bash
# This will work in PR 1.4 when Prisma is set up
cd src/backend
npx prisma db pull
```

For now, verify manually:

```bash
# Parse connection string components
echo "postgresql://dovvydive:dev_password@localhost:5432/dovvydive" | \
  sed -E 's|postgresql://([^:]+):([^@]+)@([^:]+):([^/]+)/(.+)|User: \1\nPassword: \2\nHost: \3\nPort: \4\nDatabase: \5|'
```

Expected output:
```
User: dovvydive
Password: dev_password
Host: localhost
Port: 5432
Database: dovvydive
```

## Troubleshooting

| Issue | Cause | Solution |
|-------|-------|----------|
| Connection refused | Docker not running | Start Docker: `docker compose up -d` |
| Authentication failed | Wrong credentials | Verify user/password match docker-compose.yml |
| Database not found | Database name mismatch | Ensure database name is `dovvydive` |
| SSL error on local | SSL mode set for local | Remove `?sslmode=require` from local DATABASE_URL |
| Port conflict | Local PostgreSQL running | Change port in docker-compose.yml or stop local PostgreSQL |

## Success Criteria

- ✅ `src/backend/.env.example` contains Docker DATABASE_URL
- ✅ Comments clearly distinguish local vs. production connection strings
- ✅ Format matches PostgreSQL connection string standard
- ✅ Connection credentials match docker-compose.yml settings
- ✅ File includes all other required environment variables

## Notes

- **Security:** Never commit `.env` file to git (only `.env.example`)
- **Credentials:** `dev_password` is for local development only; production uses Neon's secure credentials
- **SSL Mode:** Local Docker doesn't require SSL; production Neon requires `sslmode=require`
- **Port Customization:** If changing Docker port to 5433, update DATABASE_URL to `localhost:5433`

## Connection String Components

| Component | Local (Docker) | Production (Neon) |
|-----------|----------------|-------------------|
| Protocol | postgresql:// | postgresql:// |
| User | dovvydive | from Neon dashboard |
| Password | dev_password | from Neon dashboard |
| Host | localhost | ep-name.region.aws.neon.tech |
| Port | 5432 | (omitted, uses default) |
| Database | dovvydive | dovvydive |
| Options | (none) | ?sslmode=require |

## Next Step

Proceed to **Step 4: Root Package Scripts** (add Docker management npm scripts).
