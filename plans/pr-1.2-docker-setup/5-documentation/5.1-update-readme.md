# Step 5.1: Update README with Docker Setup Guide

**Objective:** Add comprehensive Docker setup documentation to root README.md

## Files to Modify

- `README.md` (root)

## Implementation

### Step-by-Step Instructions

#### Step 1: Add Docker Prerequisites Section

Add a new section after the "Prerequisites" section in README.md:

```markdown
## Prerequisites

- **Node.js**: 20+ (LTS recommended)
- **npm**: 10+ (comes with Node.js)
- **Docker**: Docker Desktop 4.0+ (Mac/Windows) or Docker Engine 20.10+ (Linux)

### Installing Docker

**macOS:**
```bash
# Install Docker Desktop from official website
# https://docs.docker.com/desktop/install/mac-install/

# Or via Homebrew
brew install --cask docker
```

**Windows:**
```bash
# Install Docker Desktop from official website
# https://docs.docker.com/desktop/install/windows-install/

# Requires WSL2 enabled
```

**Linux (Ubuntu/Debian):**
```bash
# Install Docker Engine
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Install Docker Compose plugin
sudo apt-get update
sudo apt-get install docker-compose-plugin

# Add user to docker group (avoid sudo)
sudo usermod -aG docker $USER
newgrp docker
```

Verify Docker installation:
```bash
docker --version
docker compose version
```
```

#### Step 2: Add Local Development Setup Section

Add after installation instructions:

```markdown
## Local Development Setup

### 1. Clone Repository

```bash
git clone https://github.com/yourusername/AI_DovvyBuddy02.git
cd AI_DovvyBuddy02
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Start Database

Start PostgreSQL with pgvector using Docker Compose:

```bash
npm run docker:up
```

This will:
- Pull the `pgvector/pgvector:pg16` image (first time only)
- Create a PostgreSQL 16 database with pgvector extension
- Persist data in a Docker volume
- Expose database on `localhost:5432`

Wait ~30 seconds for the database to be ready. Check status:

```bash
npm run docker:ps
```

Expected output:
```
NAME                 IMAGE                    STATUS                   PORTS
dovvydive-postgres   pgvector/pgvector:pg16   Up (healthy)            0.0.0.0:5432->5432/tcp
```

### 4. Configure Environment Variables

**Backend:**
```bash
cp src/backend/.env.example src/backend/.env
```

The default `.env.example` is pre-configured for Docker local development:
```bash
DATABASE_URL=postgresql://dovvydive:dev_password@localhost:5432/dovvydive
```

**Frontend:**
```bash
cp src/frontend/.env.local.example src/frontend/.env.local
```

### 5. Verify Database Connection

Test PostgreSQL connection:

```bash
npm run docker:shell
```

This opens a PostgreSQL shell. Test pgvector:

```sql
-- Check pgvector extension is enabled
\dx

-- Test vector operations
SELECT '[1,2,3]'::vector <-> '[4,5,6]'::vector AS distance;

-- Exit shell
\q
```
```

#### Step 3: Add Docker Management Section

Add a section explaining Docker commands:

```markdown
## Docker Management

### Available Commands

| Command | Description |
|---------|-------------|
| `npm run docker:up` | Start PostgreSQL container in background |
| `npm run docker:down` | Stop PostgreSQL container (keeps data) |
| `npm run docker:logs` | View PostgreSQL logs (Ctrl+C to exit) |
| `npm run docker:restart` | Restart PostgreSQL container |
| `npm run docker:clean` | **âš ï¸ Delete all data** and reset database |
| `npm run docker:ps` | Show container status |
| `npm run docker:shell` | Open PostgreSQL shell |

### Database Connection Details

**Local Development (Docker):**
- **Host:** localhost
- **Port:** 5432
- **Database:** dovvydive
- **User:** dovvydive
- **Password:** dev_password
- **Connection String:** `postgresql://dovvydive:dev_password@localhost:5432/dovvydive`

**Production (Neon):**
- Connection string provided in Neon dashboard
- Format: `postgresql://user:pass@host/database?sslmode=require`

### Data Persistence

- **`npm run docker:down`**: Stops containers but **preserves all data**
- **`npm run docker:clean`**: Stops containers and **deletes all data**

Data is stored in Docker volume `dovvydive-postgres-data`. To back up:

```bash
# Export database
docker compose exec postgres pg_dump -U dovvydive dovvydive > backup.sql

# Import database
docker compose exec -T postgres psql -U dovvydive -d dovvydive < backup.sql
```
```

#### Step 4: Add Troubleshooting Section

Add troubleshooting for common Docker issues:

```markdown
## Troubleshooting

### Docker Issues

#### Port 5432 Already in Use

**Problem:** Local PostgreSQL is running on port 5432

**Solution 1:** Stop local PostgreSQL
```bash
# macOS (Homebrew)
brew services stop postgresql@16

# Linux (systemd)
sudo systemctl stop postgresql

# Windows
# Stop PostgreSQL service in Services panel
```

**Solution 2:** Change Docker port mapping

In `docker-compose.yml`:
```yaml
ports:
  - "5433:5432"  # Use port 5433 on host
```

Update `DATABASE_URL` in `.env`:
```bash
DATABASE_URL=postgresql://dovvydive:dev_password@localhost:5433/dovvydive
```

#### Container Shows "Unhealthy"

**Problem:** Healthcheck failing

**Solution:** Wait 30-60 seconds, then check logs:
```bash
npm run docker:logs
```

Look for errors. Common causes:
- Database still initializing (wait longer)
- Init script syntax error (check `docker/postgres/init-scripts/`)
- Out of disk space (free up space)

#### Permission Denied (Linux)

**Problem:** Cannot access Docker socket

**Solution:** Add user to docker group:
```bash
sudo usermod -aG docker $USER
newgrp docker

# Verify
docker ps
```

#### Volume Permission Issues (Linux)

**Problem:** Permission denied on volume mounts

**Solution:** Fix permissions:
```bash
sudo chown -R $USER:$USER ./docker
```

#### M1/M2 Mac Issues

**Problem:** "no matching manifest for linux/arm64"

**Solution:** The `pgvector/pgvector:pg16` image supports ARM64 natively. If issues persist:
```bash
# Pull image explicitly
docker pull --platform linux/arm64 pgvector/pgvector:pg16
```

#### Database Connection Refused

**Problem:** Backend can't connect to database

**Checklist:**
1. Container running? `npm run docker:ps`
2. Container healthy? Status should show "Up (healthy)"
3. Correct DATABASE_URL? Check `.env` file
4. Firewall blocking? (rare)

**Solution:**
```bash
# Restart Docker
npm run docker:restart

# Or full reset
npm run docker:clean
npm run docker:up
```

### VS Code Issues

#### TypeScript Errors Not Showing

**Solution:** Reload VS Code TypeScript server:
- Press `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux)
- Type "TypeScript: Restart TS Server"
- Press Enter

#### ESLint Not Auto-Fixing

**Solution:** Check settings:
```json
// .vscode/settings.json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

Reload VS Code window:
- Press `Cmd+Shift+P` / `Ctrl+Shift+P`
- Type "Developer: Reload Window"
```

#### Step 5: Update Quick Start Section (if exists)

Add or update a Quick Start section:

```markdown
## Quick Start

```bash
# 1. Install dependencies
npm install

# 2. Start database
npm run docker:up

# 3. Copy environment files
cp src/backend/.env.example src/backend/.env
cp src/frontend/.env.local.example src/frontend/.env.local

# 4. Verify database connection
npm run docker:shell
# Type \q to exit

# 5. Start development (when backend/frontend are ready)
# npm run dev
```

**First time setup complete!** ðŸŽ‰

To stop the database at the end of the day:
```bash
npm run docker:down
```

To start again tomorrow:
```bash
npm run docker:up
```
```

## Verification Steps

### 1. Verify Markdown Syntax

```bash
# Install markdownlint (optional)
npm install -g markdownlint-cli

# Check README
markdownlint README.md
```

### 2. Test All Commands in README

Follow the README from scratch:

```bash
# Start fresh
npm run docker:clean

# Follow Quick Start section step-by-step
npm install
npm run docker:up
cp src/backend/.env.example src/backend/.env
npm run docker:shell
```

### 3. Verify Links Work

Check that all links in README are valid:
- Docker installation links
- GitHub repository link
- Any other external links

### 4. Review Formatting

Open README.md in VS Code preview:
- Press `Cmd+Shift+V` (Mac) or `Ctrl+Shift+V` (Windows/Linux)
- Verify code blocks render correctly
- Check table formatting
- Verify section hierarchy

## Success Criteria

- âœ… README includes Docker prerequisites with installation instructions
- âœ… Local Development Setup section walks through database setup
- âœ… Docker Management section documents all npm scripts
- âœ… Troubleshooting section covers common issues
- âœ… Quick Start provides complete setup in <10 commands
- âœ… All code examples are copy-paste ready
- âœ… Markdown syntax is valid

## Notes

- **Clarity:** Assume reader is new to Docker
- **Completeness:** Every command should have expected output
- **Troubleshooting:** Cover real issues encountered during testing
- **Maintenance:** Update when new Docker features added

## Example Output After Following README

A developer following the README should be able to:

1. **Install Docker** (if not already installed)
2. **Clone repository**
3. **Run `npm install`**
4. **Run `npm run docker:up`**
5. **See "Up (healthy)" status** within 30 seconds
6. **Connect to database** via `npm run docker:shell`
7. **Verify pgvector works** with test query

Total time: **~10 minutes** for first-time setup

## Next Step

This completes all implementation steps for PR 1.2! 

**Final Checklist:**
- [ ] All substeps implemented (1.1 through 5.1)
- [ ] README updated with comprehensive documentation
- [ ] All scripts tested and working
- [ ] Docker Compose configuration verified
- [ ] Database initialization script tested
- [ ] Environment variables documented

Proceed to **open PR 1.2** against `main` branch.
