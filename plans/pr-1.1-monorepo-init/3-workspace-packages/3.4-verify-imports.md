# Step 3.4: Verify Cross-Workspace Imports

**Part of:** Step 3 from plan.md  
**Focus:** Test that frontend and backend can import from shared workspace  
**Estimated Time:** 10 minutes

## Overview

This substep verifies that the path aliases and npm workspace configuration work correctly by creating test files in frontend and backend that import from the shared workspace.

## Pre-Substep Checklist

- [ ] **Branch:** Working on `1.1-monorepo-init`
- [ ] **Prior Step:** Completed Step 3.3 (Shared workspace created)
- [ ] **Verification:** All three workspaces have package.json and tsconfig.json

## Implementation

### Goal
Verify cross-workspace imports work correctly using TypeScript path aliases.

### Step-by-Step Instructions

#### Step 1: Create Test File in Backend
- [ ] Create `src/backend/src/` directory:

```bash
mkdir -p src/backend/src
```

- [ ] Create `src/backend/src/test-imports.ts`:

```typescript
/**
 * Test file to verify cross-workspace imports
 * This file will be deleted after verification
 */

import { DiveSite, DifficultyLevel, slugify } from '@shared';
import type { User, Session } from '@shared/types';

// Test type usage
const testUser: User = {
  id: '123',
  createdAt: new Date(),
};

const testSession: Session = {
  id: 'sess_123',
  userId: testUser.id,
  createdAt: new Date(),
  expiresAt: new Date(Date.now() + 86400000),
};

// Test enum usage
const testSite: DiveSite = {
  id: '1',
  name: 'Test Dive Site',
  slug: slugify('Test Dive Site'),
  country: 'Malaysia',
  region: 'Sabah',
  latitude: 4.0,
  longitude: 118.0,
  depthMin: 5,
  depthMax: 30,
  difficulty: DifficultyLevel.INTERMEDIATE,
};

// Test utility function
console.log('Test site slug:', testSite.slug);

export { testUser, testSession, testSite };
```

#### Step 2: Run TypeScript Check on Backend
- [ ] Run type-check from backend workspace:

```bash
cd src/backend
npm run type-check
cd ../..
```

Expected output: No TypeScript errors

#### Step 3: Create Test File in Frontend (App Directory Structure)
- [ ] Create frontend test directory:

```bash
mkdir -p src/frontend/app
```

- [ ] Create `src/frontend/app/test-imports.ts`:

```typescript
/**
 * Test file to verify cross-workspace imports in frontend
 * This file will be deleted after verification
 */

import { DiveSite, DifficultyLevel, slugify, isValidEmail } from '@shared';
import type { ApiResponse, PaginatedResponse } from '@shared/types';

// Test utility functions
const siteSlug = slugify('Sipadan Island');
const emailValid = isValidEmail('test@example.com');

console.log('Slug:', siteSlug);
console.log('Email valid:', emailValid);

// Test API response type
const mockResponse: ApiResponse<DiveSite> = {
  success: true,
  data: {
    id: '1',
    name: 'Sipadan Island',
    slug: siteSlug,
    country: 'Malaysia',
    region: 'Sabah',
    latitude: 4.1101,
    longitude: 118.6277,
    depthMin: 5,
    depthMax: 40,
    difficulty: DifficultyLevel.ADVANCED,
  },
  timestamp: new Date().toISOString(),
};

// Test paginated response type
const mockPaginated: PaginatedResponse<DiveSite> = {
  items: [],
  total: 0,
  page: 1,
  pageSize: 10,
};

export { mockResponse, mockPaginated };
```

#### Step 4: Run TypeScript Check on Frontend
- [ ] Run type-check from frontend workspace:

```bash
cd src/frontend
npm run type-check
cd ../..
```

Expected output: No TypeScript errors

#### Step 5: Run Type-Check Across All Workspaces
- [ ] Run type-check from root:

```bash
npm run type-check
```

Expected output: All workspaces pass type-checking

#### Step 6: Clean Up Test Files
- [ ] Remove test files:

```bash
rm src/backend/src/test-imports.ts
rm src/frontend/app/test-imports.ts
```

Note: Keep the `src/backend/src/` and `src/frontend/app/` directories - they'll be used in future PRs

## Verification Checklist

- [ ] Backend test file compiles without TypeScript errors
- [ ] Frontend test file compiles without TypeScript errors
- [ ] `npm run type-check` passes for all workspaces
- [ ] Imports from `@shared` resolve correctly
- [ ] Imports from `@shared/types` resolve correctly
- [ ] Enum values are accessible
- [ ] Utility functions are accessible
- [ ] Test files cleaned up

## Troubleshooting

| Issue | Solution |
|-------|----------|
| `Cannot find module '@shared'` | Verify path aliases in tsconfig.json, ensure `baseUrl` and `paths` are set |
| `Module not found` in frontend | Ensure frontend tsconfig.json has correct relative path to shared: `../shared/` |
| Type errors in test files | Check that shared types are exported correctly in `src/shared/types/index.ts` |
| `npm run type-check` fails | Run `npm install` again to ensure workspaces are linked |
| Path alias not working in IDE | Reload VS Code window or restart TypeScript server |

## Files Modified

- [ ] ✅ Created (temporary): `src/backend/src/test-imports.ts`
- [ ] ✅ Created (temporary): `src/frontend/app/test-imports.ts`
- [ ] ✅ Cleaned up: Both test files removed after verification
- [ ] ✅ Kept: `src/backend/src/` and `src/frontend/app/` directories

## What Comes Next

- Next step: Step 4 - VS Code Workspace Settings & Documentation
- Cross-workspace imports are verified and working
- Step 3 (Workspace Package Configuration) is now complete
