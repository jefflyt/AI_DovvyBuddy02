# Step 3.3: Create Shared Workspace Package

**Part of:** Step 3 from plan.md  
**Focus:** Create shared package with types and utilities for cross-workspace imports  
**Files to Create:**
- `src/shared/package.json`
- `src/shared/tsconfig.json`
- `src/shared/index.ts`
- `src/shared/types/index.ts`
- `src/shared/utils/index.ts`

**Estimated Time:** 15 minutes

## Overview

This substep creates the shared workspace that provides common types and utilities used by both frontend and backend. This enables type-safe cross-workspace imports via the `@shared` path alias.

## Pre-Substep Checklist

- [ ] **Branch:** Working on `1.1-monorepo-init`
- [ ] **Prior Step:** Completed Step 3.2 (Backend workspace created)
- [ ] **Folder Status:** `src/shared/` exists (only `.gitkeep` inside)

## Implementation

### Goal
Set up shared workspace with barrel exports for types and utilities accessible from frontend and backend.

### Step-by-Step Instructions

#### Step 1: Create Shared package.json
- [ ] Remove `.gitkeep` from `src/shared/`:

```bash
rm src/shared/.gitkeep
```

- [ ] Create `src/shared/package.json`:

```json
{
  "name": "@dovvydive/shared",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "main": "./index.ts",
  "types": "./index.ts",
  "scripts": {
    "type-check": "tsc --noEmit",
    "lint": "eslint . --ext .ts"
  },
  "devDependencies": {
    "@types/node": "^20.11.5"
  }
}
```

#### Step 2: Create Shared tsconfig.json
- [ ] Create `src/shared/tsconfig.json`:

```json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "lib": ["ES2022"],
    "moduleResolution": "bundler",
    "rootDir": ".",
    "outDir": "./dist",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "composite": true,
    "noEmit": false,
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "types": ["node"]
  },
  "include": [
    "**/*.ts"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.spec.ts",
    "**/*.test.ts"
  ]
}
```

#### Step 3: Create Directory Structure
- [ ] Create types and utils directories:

```bash
mkdir -p src/shared/types
mkdir -p src/shared/utils
```

#### Step 4: Create Shared Types Index
- [ ] Create `src/shared/types/index.ts`:

```typescript
/**
 * Shared Types Module
 * 
 * This module exports common TypeScript types and interfaces
 * used across frontend and backend workspaces.
 */

// Example type demonstrating cross-workspace type sharing
export interface User {
  id: string;
  createdAt: Date;
}

export interface Session {
  id: string;
  userId?: string;
  createdAt: Date;
  expiresAt: Date;
}

export interface DiveSite {
  id: string;
  name: string;
  slug: string;
  country: string;
  region: string;
  latitude: number;
  longitude: number;
  depthMin: number;
  depthMax: number;
  difficulty: DifficultyLevel;
}

export enum DifficultyLevel {
  BEGINNER = 'BEGINNER',
  INTERMEDIATE = 'INTERMEDIATE',
  ADVANCED = 'ADVANCED',
  TECHNICAL = 'TECHNICAL',
}

export enum CertificationLevel {
  OPEN_WATER = 'OPEN_WATER',
  ADVANCED_OPEN_WATER = 'ADVANCED_OPEN_WATER',
  RESCUE = 'RESCUE',
  DIVEMASTER = 'DIVEMASTER',
}

// API Response types
export interface ApiResponse<T = unknown> {
  success: boolean;
  data?: T;
  error?: string;
  timestamp: string;
}

export interface PaginatedResponse<T = unknown> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
}
```

#### Step 5: Create Shared Utils Index
- [ ] Create `src/shared/utils/index.ts`:

```typescript
/**
 * Shared Utilities Module
 * 
 * This module exports common utility functions
 * used across frontend and backend workspaces.
 */

/**
 * Generates a slug from a string
 */
export function slugify(text: string): string {
  return text
    .toLowerCase()
    .trim()
    .replace(/[^\w\s-]/g, '')
    .replace(/[\s_-]+/g, '-')
    .replace(/^-+|-+$/g, '');
}

/**
 * Validates an email address
 */
export function isValidEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

/**
 * Formats a date to ISO string
 */
export function formatDate(date: Date): string {
  return date.toISOString();
}

/**
 * Delays execution for specified milliseconds
 */
export function delay(ms: number): Promise<void> {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
```

#### Step 6: Create Main Shared Index
- [ ] Create `src/shared/index.ts`:

```typescript
/**
 * Shared Module - Main Entry Point
 * 
 * This is the main barrel export file that re-exports
 * all types and utilities for cross-workspace imports.
 * 
 * Usage in frontend/backend:
 * import { DiveSite, slugify } from '@shared';
 * import type { User } from '@shared/types';
 */

// Re-export all types
export * from './types/index.js';

// Re-export all utilities
export * from './utils/index.js';
```

#### Step 7: Install Shared Workspace
- [ ] Run npm install from the root:

```bash
npm install
```

## Verification Checklist

- [ ] File created: `src/shared/package.json`
- [ ] File created: `src/shared/tsconfig.json`
- [ ] File created: `src/shared/index.ts`
- [ ] File created: `src/shared/types/index.ts`
- [ ] File created: `src/shared/utils/index.ts`
- [ ] Directories created: `src/shared/types/`, `src/shared/utils/`
- [ ] `npm install` completed successfully
- [ ] Workspace linked: `npm ls @dovvydive/shared --depth=0` shows the package

## Troubleshooting

| Issue | Solution |
|-------|----------|
| TypeScript can't find shared types | Verify path aliases in frontend/backend tsconfig.json |
| Import errors with `.js` extension | This is correct for ESM - TypeScript requires `.js` in imports even for `.ts` files |
| `npm install` fails | Ensure root `package.json` has workspaces array including `src/shared` |
| Circular dependency warnings | Ensure shared doesn't import from frontend or backend |

## Files Modified

- [ ] ✅ Created: `src/shared/package.json`
- [ ] ✅ Created: `src/shared/tsconfig.json`
- [ ] ✅ Created: `src/shared/index.ts`
- [ ] ✅ Created: `src/shared/types/index.ts`
- [ ] ✅ Created: `src/shared/utils/index.ts`
- [ ] ✅ Removed: `src/shared/.gitkeep`

## What Comes Next

- Next substep: Step 3.4 - Verify cross-workspace imports
- Shared workspace is now ready to be imported by frontend and backend
